name: Phantom Compliance Bot

on: [push, pull_request]

jobs:
  validate-profiles:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Run Compliance Scan
        run: |
          python -c "
          import os, json, sys

          error_count = 0
          required_keys = ['schema_version', 'maintainer', 'id']
          
          print('ðŸ” Starting Phantom Compliance Scan...')

          for root, dirs, files in os.walk('.'):
              if '.git' in root: continue
              
              for file in files:
                  if file.endswith('.json') and 'template' not in file:
                      path = os.path.join(root, file)
                      try:
                          with open(path, 'r', encoding='utf-8') as f:
                              data = json.load(f)
                          
                          # Check 1: Must have Maintainer
                          if data.get('maintainer') != 'BlackPhantomm':
                              print(f'âŒ [FAIL] {file}: Missing or wrong maintainer!')
                              error_count += 1
                              
                          # Check 2: Must have Schema Version
                          if 'schema_version' not in data:
                              print(f'âŒ [FAIL] {file}: Missing schema_version!')
                              error_count += 1
                              
                      except json.JSONDecodeError:
                          print(f'ðŸ’€ [CRITICAL] {file}: Invalid JSON format!')
                          error_count += 1
                          
          if error_count > 0:
              print(f'\nðŸš« Scan Failed! Found {error_count} issues.')
              sys.exit(1)
          else:
              print('\nâœ… All systems nominal. Phantom Protocol compliant.')
          "